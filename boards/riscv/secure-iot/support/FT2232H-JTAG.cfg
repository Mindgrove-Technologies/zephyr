# Adapter driver: FT2232H-based JTAG adapter
adapter driver ftdi
# FTDI VID and PID for FT2232H
ftdi vid_pid 0x0403 0x6010

# Define the pin mappings for the FT2232H Channel A (ADBUS) to the JTAG signals
# Configure JTAG signals and GPIO pins
# AD0 - TCK
# AD1 - TDI
# AD2 - TDO
# AD3 - TMS
# AD4 - TRST
# AD5 - nSRST
ftdi layout_init 0x0808 0x0a1b

# Optional reset signal assignments (if used in your circuit)
# These assign specific pins on the FT2232H to the JTAG reset signals
# AD4 as nTRST (Test Reset)
ftdi layout_signal nTRST -data 0x0010
# AD5 as nSRST (System Reset)
ftdi layout_signal nSRST -data 0x0020
# Reset configuration
# Use both TRST and nSRST for reset handling
reset_config trst_and_srst separate srst_push_pull

# Set JTAG clock speed in kHz (10 MHz)
adapter speed 10000

# Set to sample on falling edge of TDO for better performance at higher speeds
ftdi tdo_sample_edge falling

# Select the JTAG transport
transport select jtag

# Define the JTAG TAP for the RISC-V target
set _CHIPNAME riscv
jtag newtap $_CHIPNAME cpu -irlen 5 -expected-id 0x100039d3

set _TARGETNAME $_CHIPNAME.cpu
target create $_TARGETNAME.0 riscv -chain-position $_TARGETNAME
$_TARGETNAME.0 configure -work-area-phys 0x80000000 -work-area-size 10000 -work-area-backup 1
riscv set_mem_access sysbus

# Initialize the JTAG chain
flash bank 0 secureiot 0 0 0 0 $_TARGETNAME.0

init
halt